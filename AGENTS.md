# Repository Guidelines

## Project Structure & Module Organization
- `sketchs/` — p5.js lesson sketches. Each topic lives in its own folder (e.g., `01_lsystem/`) with `index.html`, `sketch.js`, and `style.css` ready for OpenProcessing.
- `sketchs/index.html` — workshop landing page that links learners to each sketch and documents local usage steps.
- `tools/` — automation scripts, notably `capture-screenshots.js` for Playwright-based verification.
- `screenshots/` — autogenerated previews created by `npm run capture` (safe to regenerate).
- `misc/` — research notes and reference material; keep exploratory files here to avoid mixing with runnable assets.

## Build, Test, and Development Commands
- `npm install` — install dev tooling (`http-server`, `playwright`). Run once per environment, then run `npx playwright install chromium` if browsers are missing.
- `npm run dev` — serve `sketchs/` at `http://localhost:4173` for live review during authoring sessions.
- `npm run capture` — launch headless Chromium via Playwright, interact with each sketch, and export PNG captures into `screenshots/`.

## Coding Style & Naming Conventions
- Use 2-space indentation for HTML/CSS/JS and prefer descriptive IDs/class names that mirror workshop vocabulary.
- Keep sketches self-contained: reference assets relatively, avoid global changes to shared libraries, and rely on CDN-hosted p5.js.
- For new lessons, follow folder naming pattern `NN_topic` (zero-padded sequence plus concise snake_case topic).

## Testing Guidelines
- Favor visual regression by running `npm run capture` after meaningful UI changes; commit deltas only when they illustrate intentional updates.
- Manually sanity-check sliders, toggles, and canvas interactions in `npm run dev` before shipping.
- When adding new automation, document expected output paths and failure modes inside `tools/` scripts.

## Commit & Pull Request Guidelines
- Write focused commits with imperative subject lines (e.g., `Add Perlin noise palette selector`).
- Reference related notes in `misc/` or screenshots when discussion context helps reviewers.
- Pull requests should summarize learner-facing changes, list affected sketches, note verification steps (command output, captures), and include screenshots when visual updates are central.

## Workshop Viewing Workflow
- 参加者向けのトップページは `sketchs/index.html`（`npm run dev` 後の `http://127.0.0.1:4173/`）で提供する。各カードからレッスン固有の OpenProcessing 埋め込みページへ遷移させる。
- 参加者ページ `sketchs/NN_topic/index.html` は OpenProcessing のシェア用 URL（`https://openprocessing.org/sketch/<id>/embed/`）をフルスクリーン iframe で表示する。ヒーロー領域にはアルゴリズムの概要と観察ポイントのみ載せ、内部向けメモは別資料へ分離する。
- 埋め込みが 4〜5 秒経過してもロードされなかった場合のみ「OpenProcessing を開く」ボタンを表示し、同一スケッチのブラウザ表示に案内する。ロード完了時は必ずプレースホルダを非表示にする。
- 開発者用のローカルプレビューは `/dev/` からアクセスし、各 `local.html` を通じてモジュール構成を確認しながら調整する。OpenProcessing へコピーするコードの真実は `sketchs/NN_topic/` 配下のスケッチ用 JavaScript 群に置き、レッスンごとの構成を保つ。
- 参加者用 HTML には内部運用メモやキーボードショートカットの説明を表示しない。これらは `AGENTS.md` や `misc/` のノートにまとめ、口頭または別資料で共有する。
- ローカル専用の dat.GUI ロジックは `local-gui.js` に分離し、`local.html` では `lsystem-ready` イベント経由で GUI を初期化する。OpenProcessing では必要なスクリプトを 01_lsystem 以下の読み込み順どおりに追加する。
- `01_lsystem` は `config.js` / `engine.js` / `gui.js` / `sketch.js` の 4 ファイル構成。OpenProcessing で実行する際はこれらを同一プロジェクトに追加し、`config.js` → `engine.js` → `gui.js` → `sketch.js` の順に読み込む。
- 各スケッチの参加者ページではヒーローセクションにアルゴリズムの概要とリファレンスポイント、ワークショップトップへの戻りリンク、埋め込みビューには全画面トグルと「別タブで開く」導線を必ず用意する。背景テーマはスケッチ内容に合わせて設計する。
- OpenProcessing の URL は各ページ下部の `OPENPROCESSING_URL` 定数を編集して設定する。空文字のままの場合は埋め込みを表示せず、代わりに未設定メッセージとボタン無効化が働く。
